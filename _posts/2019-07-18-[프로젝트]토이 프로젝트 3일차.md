---
layout: post
title: "토이 프로젝트 3일차 - Entity클래스와 Repository작성"
date: 2019-07-18 15:56:00
categories: project
permalink: /HabitList/Day03
---

# JPA 설정하기

JPA를 사용하기 위해서는 2가지 파일이 필요하다. 실제 DB Entity와 동일하게 생긴 Java Object파일과 이를 DB와 연결시켜줄 Repository를 생성해야한다.



# Entity 클래스

Entity 클래스란?

- DB엔티티를 Java Object로 표현한 model class를 관리하는 패키지 주소이다.
- 실제 DB의 테이블과 매칭되는 클래스이다.

![](..\img\toy_jpa.JPG)

Entity 클래스 작성하기

- common이라는 공통의 패키지에서 디비와 관련된 것을 모아 처리할 수 있도록 Entity를 설정한다.

- 모든 Entity들은 id(pk)를 가지고 있으며 created_at, updated_at을 설정하기 때문에 중복을 피하기위해 상속의 구조로 작성한다. BaseEntity라는 부모 클래스를 작성한다.

  ![](..\img\toy_entity_str.JPG)

```java
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
@ToString
public class BaseEntity implements Serializable {


    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @CreatedDate
    private LocalDateTime createdAt;
    
    @LastModifiedDate
    private LocalDateTime updatedAt;
    ...
}
```

- @MappedSuperclass : 부모클래스는 DB와 맵핑하지 않는 어노테이션 설정이다. 자식 클래스에서만 DB와 맵핑할 수 있도록 한다.
- @EntityListeners(AuditingEntityListener.class) : @EntityListeners는 엔티티가 변경 또는 생성될 때 콜백 이벤트를 받을 클래스를 지정한다. AuditEntityListener는 Spring data jpa에서 구현한 EntityListener이며 AuditingHandler를 통해 생성일, 수정일을 자동으로 찾아 설정한다.
- @Id : pk(primary key)를 설정하는 어노테이션이다.
- @GeneratedValue : 해당 id를 auto increment를 사용한다는 의미이다. 
- @CreatedDate, @LastModifiedDate : 엔티티 생성/수정 시간 자동 주입한다.



BaseEntity를 상속받아 DB와 실제로 맵핑되는 Entity클래스를 작성한다.

```java
@Entity
@Setter
@Getter
@ToString(callSuper = true, exclude = "habitLogs")
@Accessors(chain = true) 
public class Habit extends BaseEntity{

    private String goal;
    ...

}
```

- BaseEntity를 상속받아 공통 컬럼인 id, created_at, updated_at을 사용한다.

- @Entity : 실제 DB테이블과 맵핑되는 클래스

  

※주의할 점

1. DB는 snake_case로 작성되어 있어도 변수는 camelCase로 작성해야만 맵핑이된다. 
2. @Data라는 어노테이션 말고 @Getter, @Setter, @ToString을 따로 사용한 이유 : @Data 어노테이션은 @ToString, @EqualsAndHashCode, @Getter, @Setter, @RequiredArgsConstructor을 한번에 내포하는 어노테이션이다. 굉장히 강력하지만  @EqualsAndHashCode, @RequiredArgsConstructor를 무분별하게 사용하게되면 차후 기능 변경시 어려울 수 있다고 한다. **



# Repository 인터페이스

Repository란?

- DB와 연결을 관리해주는 인터페이스이다.

- SQL를 사용하여 DB에 접근한 후 적절한 CRUD API를 제공한다.

- 각 인터페이스는 JpaRepository를 상속받게되며, 제네릭에 들어가는 변수는 **<mapping model, primary key type>**을 넣게 되어있다.

  

Repository 작성하기

- @Repository : 해당 인터페이스는 Repository라고 명시하는 어노테이션이다.

```java
@Repository
public interface TodoRepository extends JpaRepository<Todo, Long> {
		...
}
```



#  Reference

>  <https://gmlwjd9405.github.io/2018/12/25/difference-dao-dto-entity.html> - 설명 참고
>
>  <http://kwonnam.pe.kr/wiki/java/jpa/springdatajpa/audit> - 주의사항 참고
>
>  <http://kwonnam.pe.kr/wiki/java/lombok/pitfall> - 주의사항 참고
>
>  <https://jojoldu.tistory.com/251> - 주의사항 참고
>
>  <https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.core-concepts>


