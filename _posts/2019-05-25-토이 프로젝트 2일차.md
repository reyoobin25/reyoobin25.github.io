---
layout: post
title: "토이 프로젝트 2일차 - setting"
date: 2019-05-25 21:05:00
categories: project
permalink: /HabitList/Day02
---

# Multi Module Project

장점

- 역할을 분리(Front, API, Admin, Batch..등)가 가능

- 모든 프로젝트에서 공통적으로 사용하는 부분을 묶어 유지 보수가 용이

- 중복을 줄일 수 있음

단점

- 공통적인 부분을 잘못 나눌 경우, 필요없는 코드를 계속 들고 있게 됨

```groovy
group 'habit-list'
version '1.0-SNAPSHOT'
    
//외부에 라이브러리 설정
buildscript {
    ext { //추가 속성 작성
        ...
    }
    repositories {
        mavenCentral()
    }
    dependencies {
        ...
    }
}

//모든 서브프로젝트의 공통적인 부분을 설정
subprojects {

    apply plugin: 'java'// 자바 플러그인
    ...

    sourceCompatibility = 1.8  // 자바 사용버전

    repositories {
        ...
    }

    dependencies { // 실질적인 사용 프레임워크 디펜던시 사용할 프레임워크들을 지정
        ...
    }

}

//개별적인 서브 프로젝트 설정 가능
project(':common'){
    jar {
        enabled = true
    }

    bootJar { //common은 실행 가능한 jar파일이 아님 설정 
        enabled = false
    }
    dependencies {
        runtime("mysql:mysql-connector-java")
        compile group: 'org.springframework.boot', name: 'spring-boot-starter-data-jpa', version: '2.1.3.RELEASE'
    }

}
project(':api'){
    ...
}
project(':front'){
    ...
}
project(':batch'){
    ...
}
```

이번 토이 프로젝트는 멀티모듈 프로젝트로 개발하려고 한다. 



아래는 실제로 작성한 build.gradle파일 설정이다.

```groovy

group 'habit-list'
version '1.0-SNAPSHOT'

buildscript {
    ext {
        springBootVersion = '2.1.2.RELEASE'
    }
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}") // 스프링부트 플러그인 설정
         classpath("io.spring.gradle:dependency-management-plugin:0.6.0RELEASE")
    }
}

subprojects {

    apply plugin: 'java'// 자바 플러그인
    apply plugin: 'org.springframework.boot'// 스프링 부트 플러그인
    apply plugin: 'io.spring.dependency-management'// 스프링 플러그인

    sourceCompatibility = 1.8  // 자바 사용버전

    repositories {
        mavenCentral()
    }

    dependencies { // 실질적인 사용 프레임워크 디펜던시 사용할 프레임워크들을 지정한다.
        compile('org.springframework.boot:spring-boot-starter-web')
        compile group: 'org.projectlombok', name: 'lombok', version: '1.16.22'
        testCompile('org.springframework.boot:spring-boot-starter-test')
    }

}

project(':common'){
    jar {
        enabled = true
    }

    bootJar {
        enabled = false
    }
    dependencies {
        runtime("mysql:mysql-connector-java")
        compile group: 'org.springframework.boot', name: 'spring-boot-starter-data-jpa', version: '2.1.3.RELEASE'
    }

}
project(':api'){
    dependencies {
        compile project(':common')
    }
}
project(':front'){
    dependencies {
        compile group: 'org.springframework.boot', name: 'spring-boot-starter-thymeleaf', version: '2.1.3.RELEASE'
        compile project(':common')
    }
}
project(':batch'){
    dependencies {
        compile project(':common')

    }
}
```

<br/>

# Lombok

장점

- boilerplate코드를 줄여줌(boilerplate : 필수적이지만 반복되는 코드)
- 가독성이 좋아짐
- 사용이 간편함

단점

- 협업시 모든 개발 팀원이 lombok을 설치해야 함

<br/>

# DataBase Connection 세팅

```properties
################
# DATA SOURCE #
################
spring.datasource.url=...
spring.datasource.username=...
spring.datasource.password=...

###################
# CONNECTION POOL #
###################
## 1.최대 연결 가능한 커넥션 수
## 2.연결 하는 시간 설정(30초)
## 3.유휴(쉬는) 시간(3초)
## 4.최소 커넥션 개수
spring.datasource.hikari.maximum-pool-size=10 
spring.datasource.hikari.connection-timeout=30000 
spring.datasource.hikari.idle-timeout=3000
spring.datasource.hikari.minimum-idle=2
```

<br/>

> *application.properties는 모듈간의 겹치지 않도록 주의하기*

<br/>

# JPA설정

현재 프로젝트에서는 common모듈이 core module 다른 모듈에서 공통적으로 사용되고 있다. 다른 모듈에서는 @SpringBootApplication이 위치한 패키지만을 scan하는데, 이때 common에 있는 패키지를 찾을 수 없게된다. 따라서 사용할 수 있도록 해당 모듈의 config파일에서 common패키지들을 찾을 수 있도록 설정해 준다.

```java
@Configuration
@EntityScan(basePackages = {"com.habit.common.entity"})
@EnableJpaRepositories(basePackages = {"com.habit.common.repository"})
@ComponentScan(basePackages = {"com.habit.common"})
public class JpaConfig {
    
}
```

- @Configuration : spring 설정 파일임을 알려주는 어노테이션

- @EntityScan : jpa Entity들이 위치한 패키지 주소를 위한 설정

- @EnableJpaRepositories :  jpa Repository들이 위치한 패키지 주소를 위한 설정

- @ComponentScan : 패키지 아래에 있는 component를 scan하기 위한 설정

<br/>

#  Reference

>  <https://docs.gradle.org/current/userguide/tutorial_using_tasks.html> - 설명 참고
>
>  <https://spring.io/guides/gs/accessing-data-jpa/> - 설명 참고


